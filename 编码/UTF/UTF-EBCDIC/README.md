# UTF-EBCDIC 系列

## 所收编码
### 实际存在
- [UTF-EBCDIC](https://www.unicode.org/reports/tr16/)
- [UTF-8-TR16Mod](https://www.unicode.org/reports/tr16/)

### 架空编码
- WTF-EBCDIC
- WTF-8-TR16Mod

## 解说
正如 UTF-8 兼容 ASCII 一般，我们需要兼容 EBCDIC 的编码。

当然，EBCDIC 本身就有多种实现，这也只是兼容最初的那些基本字符。

我们把中间的转换过程称为 UTF-8-TR16Mod（原文为 UTF-8-Mod，此处更改）。

## 字节结构
以下码位数统计剔除过剩码位。

UTF-EBCDIC 的结构不规律，因此不列出来。

UTF-8-TR16Mod 如下：

|字节数|第一字节|第二字节|第三字节|第四字节|第五字节|码位数|注释|
|-|-|-|-|-|-|-|-|
|单字节|0x00~0x9F|||||160||
|双字节|0xC5~0xDF|0xA0~0xBF||||864|0xC0~0xC4 属于过剩码位。|
|三字节|0xE1~0xEF|0xA0~0xBF|0xA0~0xBF|||15360|0xE0 属于过剩码位。|
|四字节|0xF0~0xF7|0xA0~0xBF|0xA0~0xBF|0xA0~0xBF||243712|0xF1B6A0A0~0xF1B7BFBF 通常不认为是合法码位。|
|五字节|0xF8~0xF9|0xA0~0xBF|0xA0~0xBF|0xA0~0xBF|0xA0~0xBF|851968||

WTF-8-TR16Mod 如下：

|字节数|第一字节|第二字节|第三字节|第四字节|第五字节|码位数|注释|
|-|-|-|-|-|-|-|-|
|单字节|0x00~0x9F|||||160||
|双字节|0xC5~0xDF|0xA0~0xBF||||864||
|三字节|0xE1~0xEF|0xA0~0xBF|0xA0~0xBF|||15360||
|四字节|0xF0~0xF7|0xA0~0xBF|0xA0~0xBF|0xA0~0xBF||245760|0xF1B6A0A0~0xF1B7BFBF 被启用。|
|五字节|0xF8~0xF9|0xA0~0xBF|0xA0~0xBF|0xA0~0xBF|0xA0~0xBF|851968||

## UTF-8-TR16Mod
### U+0000~U+009F
直接表示成单字节。

### U+00A0~U+03FF
先将 UCS Code Point 存储为双字节。

这时的结构为：
- 000000aa
- aaabbbbb

将其代入此结构，形成双字节：
- 110aaaaa
- 101bbbbb

拆开来看，就可以这么理解：

先将 UCS Code Point 记作 U。

将 U 除以 32，取出商和余数，分别记作 a₁ 和 b₁。（即：0xBF-0xA0+1=32，也就相当于把二进制的后面 5 位和前面分离了）

则两个字节分别是：
- a₁+0xC0（即：a₁ 表示是第几次 32 循环）
- b₁+0xA0（即：b₁ 表示 32 循环后的第几个）

由此就得到 U+00A0~U+03FF 的 UTF-8-TR16Mod。

### U+0400~U+3FFF
先将 UCS Code Point 存储为双字节。

这时的结构为：
- 00aaaabb
- bbbccccc

将其代入此结构，形成三字节：
- 1110aaaa
- 101bbbbb
- 101ccccc

拆开来看，就可以这么理解：

先将 UCS Code Point 记作 U。

将 U 除以 1024，取出商和余数，分别记作 a₁ 和 b₁。（即：(0xBF-0xA0+1)(0xBF-0xA0+1)=1024，也就相当于把二进制的后面 10 位和前面分离了）

将 b₁ 除以 32，取出商和余数，分别记作 a₂ 和 b₂。（即：0xBF-0xA0+1=32，也就相当于把二进制的后面 5 位和前面分离了）

则三个字节分别是：
- a₁+0xE0（即：a₁ 表示是第几次 1024 循环）
- a₂+0xA0（即：a₂ 表示是第几次 32 循环）
- b₂+0xA0（即：b₂ 表示 32 循环后的第几个）

由此就得到 U+0400~U+3FFF 的 UTF-8-TR16Mod。

### U+4000~U+3FFFF
先将 UCS Code Point 存储为三字节。

这时的结构为：
- 000000aa
- abbbbbcc
- cccddddd

将其代入此结构，形成四字节：
- 11110aaa
- 101bbbbb
- 101ccccc
- 101ddddd

拆开来看，就可以这么理解：

先将 UCS Code Point 记作 U。

将 U 除以 32768，取出商和余数，分别记作 a₁ 和 b₁。（即：(0xBF-0xA0+1)(0xBF-0xA0+1)(0xBF-0xA0+1)=32768，也就相当于把二进制的后面 15 位和前面分离了）

将 b₁ 除以 1024，取出商和余数，分别记作 a₂ 和 b₂。（即：(0xBF-0xA0+1)(0xBF-0xA0+1)=1024，也就相当于把二进制的后面 10 位和前面分离了）

将 b₂ 除以 32，取出商和余数，分别记作 a₃ 和 b₃。（即：0xBF-0xA0+1=32，也就相当于把二进制的后面 5 位和前面分离了）

则四个字节分别是：
- a₁+0xF0（即：a₁ 表示是第几次 32768 循环）
- a₂+0xA0（即：a₂ 表示是第几次 1024 循环）
- a₃+0xA0（即：a₃ 表示是第几次 32 循环）
- b₃+0xA0（即：b₃ 表示 32 循环后的第几个）

由此就得到 U+4000~U+3FFFF 的 UTF-8-TR16Mod。

### U+40000\~U+10FFFF（以及废案 U+110000\~3FFFFF）
先将 UCS Code Point 存储为三字节。

这时的结构为：
- 00aabbbb
- bcccccdd
- dddeeeee

将其代入此结构，形成五字节：
- 111110aa
- 101bbbbb
- 101ccccc
- 101ddddd
- 101eeeee

拆开来看，就可以这么理解：

先将 UCS Code Point 记作 U。

将 U 除以 1048576，取出商和余数，分别记作 a₁ 和 b₁。（即：(0xBF-0xA0+1)(0xBF-0xA0+1)(0xBF-0xA0+1)(0xBF-0xA0+1)=1048576，也就相当于把二进制的后面 20 位和前面分离了）

将 b₁ 除以 32768，取出商和余数，分别记作 a₂ 和 b₂。（即：(0xBF-0xA0+1)(0xBF-0xA0+1)(0xBF-0xA0+1)=32768，也就相当于把二进制的后面 15 位和前面分离了）

将 b₂ 除以 1024，取出商和余数，分别记作 a₃ 和 b₃。（即：(0xBF-0xA0+1)(0xBF-0xA0+1)=1024，也就相当于把二进制的后面 10 位和前面分离了）

将 b₃ 除以 32，取出商和余数，分别记作 a₄ 和 b₄。（即：0xBF-0xA0+1=32，也就相当于把二进制的后面 5 位和前面分离了）

则五个字节分别是：
- a₁+0xF8（即：a₁ 表示是第几次 1048576 循环）
- a₂+0xA0（即：a₂ 表示是第几次 32768 循环）
- a₃+0xA0（即：a₃ 表示是第几次 1024 循环）
- a₄+0xA0（即：a₄ 表示是第几次 32 循环）
- b₄+0xA0（即：b₄ 表示 32 循环后的第几个）

由此就得到 U+40000\~U+10FFFF（以及废案 U+110000\~3FFFFF）的 UTF-8-TR16Mod。

### 废案：U+400000~U+3FFFFFF
先将 UCS Code Point 存储为四字节。

这时的结构为：
- 000000ab
- bbbbcccc
- cdddddee
- eeefffff

将其代入此结构，形成六字节：
- 1111110a
- 101bbbbb
- 101ccccc
- 101ddddd
- 101eeeee
- 101fffff

拆开来看，就可以这么理解：

先将 UCS Code Point 记作 U。

将 U 除以 33554432，取出商和余数，分别记作 a₁ 和 b₁。（即：(0xBF-0xA0+1)(0xBF-0xA0+1)(0xBF-0xA0+1)(0xBF-0xA0+1)(0xBF-0xA0+1)=33554432，也就相当于把二进制的后面 25 位和前面分离了）

将 b₁ 除以 1048576，取出商和余数，分别记作 a₂ 和 b₂。（即：(0xBF-0xA0+1)(0xBF-0xA0+1)(0xBF-0xA0+1)(0xBF-0xA0+1)=1048576，也就相当于把二进制的后面 20 位和前面分离了）

将 b₂ 除以 32768，取出商和余数，分别记作 a₃ 和 b₃。（即：(0xBF-0xA0+1)(0xBF-0xA0+1)(0xBF-0xA0+1)=32768，也就相当于把二进制的后面 15 位和前面分离了）

将 b₃ 除以 1024，取出商和余数，分别记作 a₄ 和 b₄。（即：(0xBF-0xA0+1)(0xBF-0xA0+1)=1024，也就相当于把二进制的后面 10 位和前面分离了）

将 b₄ 除以 32，取出商和余数，分别记作 a₅ 和 b₅。（即：0xBF-0xA0+1=32，也就相当于把二进制的后面 5 位和前面分离了）

则六个字节分别是：
- a₁+0xFC（即：a₁ 表示是第几次 33554432 循环）
- a₂+0xA0（即：a₂ 表示是第几次 1048576 循环）
- a₃+0xA0（即：a₃ 表示是第几次 32768 循环）
- a₄+0xA0（即：a₄ 表示是第几次 1024 循环）
- a₅+0xA0（即：a₅ 表示是第几次 32 循环）
- b₅+0xA0（即：b₅ 表示 32 循环后的第几个）

由此就得到 U+400000~U+3FFFFFF 的 UTF-8-TR16Mod。

### 废案：U+4000000~U+7FFFFFFF
先将 UCS Code Point 存储为四字节。

这时的结构为：
- 0abbbbbc
- ccccdddd
- deeeeeff
- fffggggg

将其代入此结构，形成七字节：
- 1111111a
- 101bbbbb
- 101ccccc
- 101ddddd
- 101eeeee
- 101fffff
- 101ggggg

拆开来看，就可以这么理解：

先将 UCS Code Point 记作 U。

将 U 除以 1073741824，取出商和余数，分别记作 a₁ 和 b₁。（即：(0xBF-0xA0+1)(0xBF-0xA0+1)(0xBF-0xA0+1)(0xBF-0xA0+1)(0xBF-0xA0+1)(0xBF-0xA0+1)=1073741824，也就相当于把二进制的后面 30 位和前面分离了）

将 b₁ 除以 33554432，取出商和余数，分别记作 a₂ 和 b₂。（即：(0xBF-0xA0+1)(0xBF-0xA0+1)(0xBF-0xA0+1)(0xBF-0xA0+1)(0xBF-0xA0+1)=33554432，也就相当于把二进制的后面 25 位和前面分离了）

将 b₂ 除以 1048576，取出商和余数，分别记作 a₃ 和 b₃。（即：(0xBF-0xA0+1)(0xBF-0xA0+1)(0xBF-0xA0+1)(0xBF-0xA0+1)=1048576，也就相当于把二进制的后面 20 位和前面分离了）

将 b₃ 除以 32768，取出商和余数，分别记作 a₄ 和 b₄。（即：(0xBF-0xA0+1)(0xBF-0xA0+1)(0xBF-0xA0+1)=32768，也就相当于把二进制的后面 15 位和前面分离了）

将 b₄ 除以 1024，取出商和余数，分别记作 a₅ 和 b₅。（即：(0xBF-0xA0+1)(0xBF-0xA0+1)=1024，也就相当于把二进制的后面 10 位和前面分离了）

将 b₅ 除以 32，取出商和余数，分别记作 a₆ 和 b₆。（即：0xBF-0xA0+1=32，也就相当于把二进制的后面 5 位和前面分离了）

则七个字节分别是：
- a₁+0xFE（即：a₁ 表示是第几次 1073741824 循环）
- a₂+0xA0（即：a₂ 表示是第几次 33554432 循环）
- a₃+0xA0（即：a₃ 表示是第几次 1048576 循环）
- a₄+0xA0（即：a₄ 表示是第几次 32768 循环）
- a₅+0xA0（即：a₅ 表示是第几次 1024 循环）
- a₆+0xA0（即：a₆ 表示是第几次 32 循环）
- b₆+0xA0（即：b₆ 表示 32 循环后的第几个）

由此就得到 U+4000000~U+7FFFFFFF 的 UTF-8-TR16Mod。

### U+D800~U+DFFF
这一块不会定义任何字符，都拿来给 UTF-16 表示 non-BMP。

如果启用这一块，那这被叫作 WTF-8-TR16Mod。

## UTF-EBCDIC
UTF-EBCDIC 由 UTF-8-TR16Mod 将每个字节替换而来。

下面给出字节对照表：

|UTF-8-TR16Mod 字节|UTF-EBCDIC 字节|
|-|-|
|0x00|0x00|
|0x01|0x01|
|0x02|0x02|
|0x03|0x03|
|0x04|0x37|
|0x05|0x2D|
|0x06|0x2E|
|0x07|0x2F|
|0x08|0x16|
|0x09|0x05|
|0x0A|0x15|
|0x0B|0x0B|
|0x0C|0x0C|
|0x0D|0x0D|
|0x0E|0x0E|
|0x0F|0x0F|
|0x10|0x10|
|0x11|0x11|
|0x12|0x12|
|0x13|0x13|
|0x14|0x3C|
|0x15|0x3D|
|0x16|0x32|
|0x17|0x26|
|0x18|0x18|
|0x19|0x19|
|0x1A|0x3F|
|0x1B|0x27|
|0x1C|0x1C|
|0x1D|0x1D|
|0x1E|0x1E|
|0x1F|0x1F|
|0x20|0x40|
|0x21|0x5A|
|0x22|0x7F|
|0x23|0x7B|
|0x24|0x5B|
|0x25|0x6C|
|0x26|0x50|
|0x27|0x7D|
|0x28|0x4D|
|0x29|0x5D|
|0x2A|0x5C|
|0x2B|0x4E|
|0x2C|0x6B|
|0x2D|0x60|
|0x2E|0x4B|
|0x2F|0x61|
|0x30|0xF0|
|0x31|0xF1|
|0x32|0xF2|
|0x33|0xF3|
|0x34|0xF4|
|0x35|0xF5|
|0x36|0xF6|
|0x37|0xF7|
|0x38|0xF8|
|0x39|0xF9|
|0x3A|0x7A|
|0x3B|0x5E|
|0x3C|0x4C|
|0x3D|0x7E|
|0x3E|0x6E|
|0x3F|0x6F|
|0x40|0x7C|
|0x41|0xC1|
|0x42|0xC2|
|0x43|0xC3|
|0x44|0xC4|
|0x45|0xC5|
|0x46|0xC6|
|0x47|0xC7|
|0x48|0xC8|
|0x49|0xC9|
|0x4A|0xD1|
|0x4B|0xD2|
|0x4C|0xD3|
|0x4D|0xD4|
|0x4E|0xD5|
|0x4F|0xD6|
|0x50|0xD7|
|0x51|0xD8|
|0x52|0xD9|
|0x53|0xE2|
|0x54|0xE3|
|0x55|0xE4|
|0x56|0xE5|
|0x57|0xE6|
|0x58|0xE7|
|0x59|0xE8|
|0x5A|0xE9|
|0x5B|0xAD|
|0x5C|0xE0|
|0x5D|0xBD|
|0x5E|0x5F|
|0x5F|0x6D|
|0x60|0x79|
|0x61|0x81|
|0x62|0x82|
|0x63|0x83|
|0x64|0x84|
|0x65|0x85|
|0x66|0x86|
|0x67|0x87|
|0x68|0x88|
|0x69|0x89|
|0x6A|0x91|
|0x6B|0x92|
|0x6C|0x93|
|0x6D|0x94|
|0x6E|0x95|
|0x6F|0x96|
|0x70|0x97|
|0x71|0x98|
|0x72|0x99|
|0x73|0xA2|
|0x74|0xA3|
|0x75|0xA4|
|0x76|0xA5|
|0x77|0xA6|
|0x78|0xA7|
|0x79|0xA8|
|0x7A|0xA9|
|0x7B|0xC0|
|0x7C|0x4F|
|0x7D|0xD0|
|0x7E|0xA1|
|0x7F|0x07|
|0x80|0x20|
|0x81|0x21|
|0x82|0x22|
|0x83|0x23|
|0x84|0x24|
|0x85|0x25|
|0x86|0x06|
|0x87|0x17|
|0x88|0x28|
|0x89|0x29|
|0x8A|0x2A|
|0x8B|0x2B|
|0x8C|0x2C|
|0x8D|0x09|
|0x8E|0x0A|
|0x8F|0x1B|
|0x90|0x30|
|0x91|0x31|
|0x92|0x1A|
|0x93|0x33|
|0x94|0x34|
|0x95|0x35|
|0x96|0x36|
|0x97|0x08|
|0x98|0x38|
|0x99|0x39|
|0x9A|0x3A|
|0x9B|0x3B|
|0x9C|0x04|
|0x9D|0x14|
|0x9E|0x3E|
|0x9F|0xFF|
|0xA0|0x41|
|0xA1|0x42|
|0xA2|0x43|
|0xA3|0x44|
|0xA4|0x45|
|0xA5|0x46|
|0xA6|0x47|
|0xA7|0x48|
|0xA8|0x49|
|0xA9|0x4A|
|0xAA|0x51|
|0xAB|0x52|
|0xAC|0x53|
|0xAD|0x54|
|0xAE|0x55|
|0xAF|0x56|
|0xB0|0x57|
|0xB1|0x58|
|0xB2|0x59|
|0xB3|0x62|
|0xB4|0x63|
|0xB5|0x64|
|0xB6|0x65|
|0xB7|0x66|
|0xB8|0x67|
|0xB9|0x68|
|0xBA|0x69|
|0xBB|0x6A|
|0xBC|0x70|
|0xBD|0x71|
|0xBE|0x72|
|0xBF|0x73|
|0xC0|0x74|
|0xC1|0x75|
|0xC2|0x76|
|0xC3|0x77|
|0xC4|0x78|
|0xC5|0x80|
|0xC6|0x8A|
|0xC7|0x8B|
|0xC8|0x8C|
|0xC9|0x8D|
|0xCA|0x8E|
|0xCB|0x8F|
|0xCC|0x90|
|0xCD|0x9A|
|0xCE|0x9B|
|0xCF|0x9C|
|0xD0|0x9D|
|0xD1|0x9E|
|0xD2|0x9F|
|0xD3|0xA0|
|0xD4|0xAA|
|0xD5|0xAB|
|0xD6|0xAC|
|0xD7|0xAE|
|0xD8|0xAF|
|0xD9|0xB0|
|0xDA|0xB1|
|0xDB|0xB2|
|0xDC|0xB3|
|0xDD|0xB4|
|0xDE|0xB5|
|0xDF|0xB6|
|0xE0|0xB7|
|0xE1|0xB8|
|0xE2|0xB9|
|0xE3|0xBA|
|0xE4|0xBB|
|0xE5|0xBC|
|0xE6|0xBE|
|0xE7|0xBF|
|0xE8|0xCA|
|0xE9|0xCB|
|0xEA|0xCC|
|0xEB|0xCD|
|0xEC|0xCE|
|0xED|0xCF|
|0xEE|0xDA|
|0xEF|0xDB|
|0xF0|0xDC|
|0xF1|0xDD|
|0xF2|0xDE|
|0xF3|0xDF|
|0xF4|0xE1|
|0xF5|0xEA|
|0xF6|0xEB|
|0xF7|0xEC|
|0xF8|0xED|
|0xF9|0xEE|
|0xFA|0xEF|
|0xFB|0xFA|
|0xFC|0xFB|
|0xFD|0xFC|
|0xFE|0xFD|
|0xFF|0xFE|
